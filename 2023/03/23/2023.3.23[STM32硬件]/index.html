<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>STM32F103ZE部分硬件配置指南 | Te4MIVal的个人博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="板子所采用的是STMF103ZE，仅提供一些常用模块的基础配置介绍，如有错误请联系作者 前置软件设置DARMSTM.DLL	-p STM32F103ZE TARMSTM.DLL C位运算语法基础&lt;&lt;(左移一位)	&gt;&gt;(右移一位)	|(按位或)	&amp;(按位与)	优先级都高于&#x3D; 123A&#x3D;1&lt;&lt;2|1&lt;&lt;4			&#x2F;&#x2F;将(10100赋给A)">
<meta property="og:type" content="article">
<meta property="og:title" content="STM32F103ZE部分硬件配置指南">
<meta property="og:url" content="http://example.com/2023/03/23/2023.3.23[STM32%E7%A1%AC%E4%BB%B6]/index.html">
<meta property="og:site_name" content="Te4MIVal的个人博客">
<meta property="og:description" content="板子所采用的是STMF103ZE，仅提供一些常用模块的基础配置介绍，如有错误请联系作者 前置软件设置DARMSTM.DLL	-p STM32F103ZE TARMSTM.DLL C位运算语法基础&lt;&lt;(左移一位)	&gt;&gt;(右移一位)	|(按位或)	&amp;(按位与)	优先级都高于&#x3D; 123A&#x3D;1&lt;&lt;2|1&lt;&lt;4			&#x2F;&#x2F;将(10100赋给A)">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-03-23T13:13:27.300Z">
<meta property="article:modified_time" content="2023-03-23T13:22:52.578Z">
<meta property="article:author" content="Te4MIVal">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Te4MIVal的个人博客" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Te4MIVal的个人博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-2023.3.23[STM32硬件]" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/03/23/2023.3.23%5BSTM32%E7%A1%AC%E4%BB%B6%5D/" class="article-date">
  <time class="dt-published" datetime="2023-03-23T13:13:27.300Z" itemprop="datePublished">2023-03-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      STM32F103ZE部分硬件配置指南
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><strong>板子所采用的是STMF103ZE，仅提供一些常用模块的基础配置介绍，如有错误请联系作者</strong></p>
<h2 id="前置"><a href="#前置" class="headerlink" title="前置"></a>前置</h2><h3 id="软件设置"><a href="#软件设置" class="headerlink" title="软件设置"></a>软件设置</h3><p>DARMSTM.DLL	-p STM32F103ZE</p>
<p>TARMSTM.DLL</p>
<h3 id="C位运算语法基础"><a href="#C位运算语法基础" class="headerlink" title="C位运算语法基础"></a>C位运算语法基础</h3><p>&lt;&lt;(左移一位)	&gt;&gt;(右移一位)	|(按位或)	&amp;(按位与)	优先级都高于&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A=1&lt;&lt;2|1&lt;&lt;4			//将(10100赋给A)</span><br><span class="line">A=A|1				//将A的最后一位置1,不影响其他位</span><br><span class="line">A=A&amp;(0xFFFFFFFF-1)	//将A的最后一位置0,不影响其他位</span><br></pre></td></tr></table></figure>



<h2 id="中断与异常"><a href="#中断与异常" class="headerlink" title="中断与异常"></a>中断与异常</h2><h3 id="向量表"><a href="#向量表" class="headerlink" title="向量表"></a>向量表</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/*汇编程序的向量表片段*/</span><br><span class="line">	EXPORT __Vectors</span><br><span class="line">	EXPORT Reset_Handler	;声明其为全局变量,使得程序外也可调用</span><br><span class="line">		</span><br><span class="line">__Vectors</span><br><span class="line">	DCD __intitial_sp</span><br><span class="line">	DCD Reset_Handler	;复位向量表,为向量表中的第一项,程序从这里进入</span><br><span class="line">	......</span><br><span class="line">	DCD </span><br><span class="line">	</span><br><span class="line">Reset_Handler PROC</span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line">	ENDP</span><br></pre></td></tr></table></figure>

<p>中断是在CPU执行过程中,产生了预先设置的中断触发,从而停止当前进程运行中断子进程,最后回到原位置</p>
<table>
<thead>
<tr>
<th align="center">向量号</th>
<th align="center">类型</th>
<th align="center">优先级</th>
<th align="center">介绍</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0</td>
<td align="center">–</td>
<td align="center">–</td>
<td align="center">无异常处理</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">Reset</td>
<td align="center">-3</td>
<td align="center">复位</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">NMI</td>
<td align="center">-2</td>
<td align="center">不可屏蔽中断(来自NMI管脚)</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">HardFault</td>
<td align="center">-1</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">…</td>
<td align="center">…</td>
<td align="center">…</td>
<td align="center">…</td>
</tr>
<tr>
<td align="center">15</td>
<td align="center">SysTick</td>
<td align="center">可编程</td>
<td align="center">系统TICK定时器超时</td>
</tr>
<tr>
<td align="center">16</td>
<td align="center">IRQ0</td>
<td align="center">可编程</td>
<td align="center">外部设备产生的中断</td>
</tr>
<tr>
<td align="center">…</td>
<td align="center">…</td>
<td align="center">…</td>
<td align="center">…</td>
</tr>
<tr>
<td align="center">255</td>
<td align="center">IRQ239</td>
<td align="center">可编程</td>
<td align="center">外部设备产生的中断</td>
</tr>
</tbody></table>
<p>总共有15种系统中断,有240种外部中断,外部中断由**NVIC(中断控制器)**统一管理</p>
<p>**优先级:**优先级数越小,优先级最高,因为复位为最高优先级,因此为最高的-3,可编程优先级不可为负数</p>
<p>向量表的每个向量占据4个字节,从0x00000000开始</p>
<p>每个向量的地址固定,声明的时候如果使用的向量前面的向量未全部列举,则需要用SPACE N*4填充</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/*示例:调用向量号为11的SVCall内部中断*/</span><br><span class="line">__Vectors</span><br><span class="line">	DCD _initial_sp</span><br><span class="line">	DCD RESET_Handler</span><br><span class="line">	SPACE 9*4			;向量号为11,前面有10个向量,已经列举了RESET,因此还有9个需要填充</span><br><span class="line">	DCD SVC_Handler</span><br><span class="line">	</span><br><span class="line">	EXPORT Reset_Handler</span><br><span class="line">Reset_Handler PROC</span><br><span class="line">	...</span><br><span class="line">	ENDP</span><br><span class="line">	</span><br><span class="line">SVC_Handler	PROC</span><br><span class="line">	...</span><br><span class="line">	ENDP</span><br></pre></td></tr></table></figure>

<p>外部中断类似,需要注意的是 <strong>外部向量中断号+16&#x3D;向量号</strong>(内部中断从1开始计数,外部中断从0开始)</p>
<p>向量表中的每一个向量存放的都是异常入口的起始地址,而每个向量自己的地址为0x08000000+4*向量号</p>
<h3 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h3><p>当产生异常时,CPU根据异常向量号,跳转到该异常处理程序所在的位置开始执行,且保护此之前的数据便于之后跳回</p>
<p>(将R0-R3、R12、LR、PC、xPSR依次压入栈)<strong>而其他寄存器需要手动入栈！</strong>并在异常执行完之前取回</p>
<p>在进入异常子过程后,LR实际上不会直接指向上一个进程的位置,而是变成一个状态字(0xFFFFFFFX:EXIT_RETURN),告诉程序在异常子过程结尾的BX LR处释放出刚刚入栈的几个数据,再根据数据返回并继续程序</p>
<h3 id="SETENAx（使能与除能寄存器）"><a href="#SETENAx（使能与除能寄存器）" class="headerlink" title="SETENAx（使能与除能寄存器）"></a>SETENAx（使能与除能寄存器）</h3><p>使能与除能寄存器控制外设中输入的中断请求是否被采用</p>
<table>
<thead>
<tr>
<th align="center">8个使能寄存器SETENAx(32位)</th>
<th align="center">基地址0xE000E100</th>
</tr>
</thead>
</table>
<table>
<thead>
<tr>
<th align="center">8个除能寄存器CLRENAx(32位)</th>
<th align="center">基地址0xE000E180</th>
</tr>
</thead>
</table>
<p>当系统复位后,默认所有240个外部寄存器关闭,需要某个IRQn时,需要激活</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/*激活IRQ0*/</span><br><span class="line">LDR R0,=0xE000E100	</span><br><span class="line">MOV R1,#0x00000001	;每位对应一个中断,1号外部中断即为基地址偏移1位</span><br><span class="line">STR R1,[R0]</span><br></pre></td></tr></table></figure>

<p>因为为240个中断,共用到了8个寄存器,因此分为STENA0,STENA1…STENA7,每个都在基地址基础上偏移一个字</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/*激活IRQ40和IRQ233*/</span><br><span class="line">LDR R0,=0xE000E104	;40/32..1,因此使用的是第2个寄存器,要在0xE000E100基础上加1个字即4	</span><br><span class="line">MOV R1,#0x00000001	;40号IRQ为第41个,即为第二组中第9个(40-31),赋值0x00000009即可激活(?)</span><br><span class="line">STR R1,[R0]</span><br><span class="line"></span><br><span class="line">LDR R0,=0xE000E120	;233/32..7,因此使用的是第8个寄存器,要在0xE000E100基础上加8个字即32	</span><br><span class="line">MOV R1,#0x00000001	;233号IRQ为第224个,即为第二组中第10个(233-223),赋值0x00000010即可激活</span><br><span class="line">STR R1,[R0]</span><br></pre></td></tr></table></figure>

<p>因为涉及到寄存器组,因此若使用C定义则需要用到int型的数组便于访问中间的某个寄存器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">struct	_NVIC</span><br><span class="line">&#123;</span><br><span class="line">	int ISER[8];	//中断使能寄存器</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SETPENDx-挂起解挂寄存器"><a href="#SETPENDx-挂起解挂寄存器" class="headerlink" title="SETPENDx(挂起解挂寄存器)"></a>SETPENDx(挂起解挂寄存器)</h3><table>
<thead>
<tr>
<th align="center">8个挂起寄存器SETPENDx(32位)</th>
<th align="center">基地址0xE000E200</th>
</tr>
</thead>
</table>
<table>
<thead>
<tr>
<th align="center">8个解挂寄存器CLRPENDx(32位)</th>
<th align="center">基地址0xE000E280</th>
</tr>
</thead>
</table>
<p>CPU一次只能执行一个中断,在处理同级或高级优先度中断,或者被屏蔽时时,低优先级的将会在挂起寄存器中存储</p>
<p>挂起状态会一直保持,即使中断请求停止</p>
<p>一旦中断进入中断服务程序ISR准备执行时,系统会自动解挂</p>
<p><strong>外设的中断请求需要在挂起中手动清零</strong></p>
<p>使用方法同使能寄存器</p>
<h3 id="活动状态寄存器"><a href="#活动状态寄存器" class="headerlink" title="活动状态寄存器"></a>活动状态寄存器</h3><p>…</p>
<h3 id="PRI-n-优先级寄存器"><a href="#PRI-n-优先级寄存器" class="headerlink" title="PRI_n(优先级寄存器)"></a>PRI_n(优先级寄存器)</h3><p>基地址为0xE000E400,后面每个字节存储一个IRQn的优先级,范围(8位,但只有最高三位计数,其余为0)</p>
<p><strong>因此异常优先级取值只可能为0x00,0x20,0x40….0xE0</strong></p>
<table>
<thead>
<tr>
<th align="center">优先级寄存器PRI_n</th>
<th align="center">基地址0xE000E400</th>
</tr>
</thead>
</table>
<p>(IRQ0的优先级为0xE000E400,IRQ1的优先级为0xE000E401)</p>
<p>所有外部中断优先级的<strong>复位默认值</strong>为0</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LDR R0,=0xE000ED1F</span><br><span class="line">MOV R1,#0x20	;优先级010 000000设定为3</span><br><span class="line">STRB R1,[R0]	;注意是STRB,优先级为8位,必须按照字节存,同理,上一条如果要用LDR则必须为LDRB</span><br></pre></td></tr></table></figure>



<h3 id="STIR-软件触发寄存器"><a href="#STIR-软件触发寄存器" class="headerlink" title="STIR(软件触发寄存器)"></a>STIR(软件触发寄存器)</h3><p>当测试时还未外接设备时,使用该寄存器模拟中断输入</p>
<table>
<thead>
<tr>
<th align="center">软件触发寄存器STIR</th>
<th align="center">地址0xE000EF00</th>
</tr>
</thead>
</table>
<p>在该地址写入寄存器中断号即可产生相应中断</p>
<h2 id="RCC-复位与时钟控制"><a href="#RCC-复位与时钟控制" class="headerlink" title="RCC(复位与时钟控制)"></a>RCC(复位与时钟控制)</h2><p><strong>接口基地址:0x40021000</strong></p>
<table>
<thead>
<tr>
<th align="center">偏移</th>
<th align="center">寄存器</th>
<th align="center">意义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">00H</td>
<td align="center">CR</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">04H</td>
<td align="center">CFGR</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">08H</td>
<td align="center">CIR</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">0CH</td>
<td align="center">APB2RSTR</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">10H</td>
<td align="center">APB1RSTR</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">14H</td>
<td align="center">AHBENR</td>
<td align="center">高速总线使能</td>
</tr>
<tr>
<td align="center">18H</td>
<td align="center">APB2ENR</td>
<td align="center">外部总线2使能</td>
</tr>
<tr>
<td align="center">1CH</td>
<td align="center">APB1ENR</td>
<td align="center">外部总线1使能</td>
</tr>
<tr>
<td align="center">20H</td>
<td align="center">BDCR</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">24H</td>
<td align="center">CSR</td>
<td align="center"></td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/*汇编语言结构*/</span><br><span class="line">RCC	EQU	0x400021000</span><br><span class="line">RCC_CFGP	EQU	0x4</span><br><span class="line">...</span><br><span class="line">RCC_APB2RSTR	EQU 0x0C</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">/*调用*/</span><br><span class="line">LDR R0,=RCC</span><br><span class="line">LDR R0,[R0,#APB1RSTR]</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/*C语言结构*/</span><br><span class="line">headfile.h</span><br><span class="line">struct _RCC</span><br><span class="line">&#123;</span><br><span class="line">int CR;</span><br><span class="line">int CFGR;</span><br><span class="line">int CIR;</span><br><span class="line">int APB1RSTR;</span><br><span class="line">int APB2RSTR;</span><br><span class="line">int AHBENR;</span><br><span class="line">int APB2ENR;</span><br><span class="line">int APB1ENR;</span><br><span class="line">int BDCR;</span><br><span class="line">int CSR;</span><br><span class="line">&#125;;</span><br><span class="line">#define RCC((volatile struct _RCC*)0X40021000)</span><br><span class="line"></span><br><span class="line">main.c</span><br><span class="line">int main()&#123;</span><br><span class="line">RCC-&gt;APB2ENR=1&lt;&lt;2;(或者写作RCC-&gt;APB2ENR=0x00000100,位移符号的优先级高于=)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>两者都可看作是对基地址及其偏移进行宏定义便于后面调用,事实上名字可以任意取,为方便辨认统一规范</p>
<p><strong>时钟使能给对应控制的四位赋值4即可</strong></p>
<p>C语言中注意_RCC和RCC的区别, _RCC是实际上的地址,RCC是指向其的指针,在C中调用使用指针RCC</p>
<p>C使用结构体的优势:寄存器为32位,正好与int型相同,因此可用这种对应关系匹配地址</p>
<p>注意define语句**#define RCC((volatile struct _RCC*)0X40021000)**</p>
<p><strong>APB使能</strong></p>
<p>APB2:ADCx , GPIOx , TIM1,8 , USART1</p>
<h2 id="GPIO-通用IO口"><a href="#GPIO-通用IO口" class="headerlink" title="GPIO(通用IO口)"></a>GPIO(通用IO口)</h2><p>以STM32F103ZE为例,有7个16位GPIO口:GPIOA,GPIOB…….GPIOG</p>
<table>
<thead>
<tr>
<th align="center">GPIOn</th>
<th align="center">接口基地址</th>
</tr>
</thead>
<tbody><tr>
<td align="center">GPIOA</td>
<td align="center">0x40010800</td>
</tr>
<tr>
<td align="center">GPIOB</td>
<td align="center">0x40010C00</td>
</tr>
<tr>
<td align="center">GPIOC</td>
<td align="center">0x40011000</td>
</tr>
<tr>
<td align="center">GPIOD</td>
<td align="center">0x40011400</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="center">GPIOn寄存器</th>
<th align="center">偏移地址</th>
<th align="center">功能</th>
</tr>
</thead>
<tbody><tr>
<td align="center">GPIOx_CRL</td>
<td align="center">0x00</td>
<td align="center">GPIOx低8位输出属性</td>
</tr>
<tr>
<td align="center">GPIOx_CRH</td>
<td align="center">0x04</td>
<td align="center">GPIOx高8位输出属性</td>
</tr>
<tr>
<td align="center">GPIOx_IDR</td>
<td align="center">0x08</td>
<td align="center">GPIOx16位的输入值</td>
</tr>
<tr>
<td align="center">GPIOx_ODR</td>
<td align="center">0xC0</td>
<td align="center">GPIOx16位的输出值</td>
</tr>
</tbody></table>
<p>注:IDR口与ODR口仅使用低16位</p>
<p>CRL与CRH各管理8个管脚,每个管脚使用四位控制</p>
<p>四位控制如下</p>
<p><strong>低两位</strong></p>
<table>
<thead>
<tr>
<th align="center">00</th>
<th align="center">01</th>
<th align="center">10</th>
<th align="center">11</th>
</tr>
</thead>
<tbody><tr>
<td align="center">输入模式(复位默认状态)</td>
<td align="center">输出模式(最大10MHz)</td>
<td align="center">输出模式(最大20MHz)</td>
<td align="center">输出模式(最大50MHz)</td>
</tr>
</tbody></table>
<p><strong>高两位</strong></p>
<table>
<thead>
<tr>
<th></th>
<th>00</th>
<th>01</th>
<th>10</th>
<th>11</th>
</tr>
</thead>
<tbody><tr>
<td>输入模式</td>
<td>模拟输入模式</td>
<td>浮空输入模式(复位默认状态)</td>
<td>上拉&#x2F;下拉输入模式</td>
<td>保留</td>
</tr>
<tr>
<td>输出模式</td>
<td>通用推挽输出模式</td>
<td>通用开漏输出模式</td>
<td>复用功能推挽输出</td>
<td>复用功能开漏输出</td>
</tr>
</tbody></table>
<p>输入模式采用10时,通过ODR寄存器辅助判断是上拉(1)还是下拉(0)</p>
<p>默认使用输出为0011(3),默认输出使用1000(8)	(或者为4:0100)</p>
<h2 id="UART-串口-通用异步收发传输器"><a href="#UART-串口-通用异步收发传输器" class="headerlink" title="UART(串口:通用异步收发传输器)"></a>UART(串口:通用异步收发传输器)</h2><p><strong>波特率</strong>:每秒传输码元的数目,一个比特位传输时长为码元周期,倒数为波特率</p>
<p>传输线在没有数据传输时保持1,起始0,中间8位数据,可加一个校验位(所有求和判断奇偶),后面停止1</p>
<p><strong>串口的时钟使能:APB2的15号位为USART1时钟使能</strong></p>
<table>
<thead>
<tr>
<th align="center">寄存器</th>
<th align="center">功能</th>
<th align="center">偏移地址</th>
<th align="center">复位值</th>
</tr>
</thead>
<tbody><tr>
<td align="center">USART_SR</td>
<td align="center">状态寄存器</td>
<td align="center">0x0</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">USART_DR</td>
<td align="center">数据寄存器</td>
<td align="center">0x4</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">USART_BRR</td>
<td align="center">波特率寄存器</td>
<td align="center">0x8</td>
<td align="center">0x0000</td>
</tr>
<tr>
<td align="center">USART_CR1</td>
<td align="center">控制寄存器</td>
<td align="center">0xC</td>
<td align="center">0x0000</td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">struct _USART</span><br><span class="line">&#123;</span><br><span class="line">	int SR;</span><br><span class="line">	int DR;</span><br><span class="line">	int BRR;</span><br><span class="line">	int CR1;</span><br><span class="line">	int CR2;</span><br><span class="line">	int CR3;</span><br><span class="line">&#125;</span><br><span class="line">#define USART1((volatile struct _USART*)0x40013800)</span><br></pre></td></tr></table></figure>

<p>UART默认,PA9为输出,PA10为输入</p>
<p><strong>注:在默认情况下PA9必须置为0xB,PA10必须置为0x4!!!</strong></p>
<h3 id="USART-BRR-波特率寄存器"><a href="#USART-BRR-波特率寄存器" class="headerlink" title="USART_BRR(波特率寄存器)"></a>USART_BRR(波特率寄存器)</h3><p>共使用寄存器的16位,低四位存DIV_F(商),高四位存DIV_M(余数:小数部分)</p>
<p>波特率计算公式:baud&#x3D;f&#x2F;(16*DIV_M+DIV_F)</p>
<p>例如主频为8MHz,设置波特率为16kbps,则寄存器计算:</p>
<p>(8*10^6)&#x2F;(16*10^3)&#x2F;16&#x3D;31.25  (整数部分为31,小数部分为0.25)即设置寄存器为0x0000 01f4</p>
<h3 id="USART-CR-设置寄存器"><a href="#USART-CR-设置寄存器" class="headerlink" title="USART_CR(设置寄存器)"></a>USART_CR(设置寄存器)</h3><p>通用设置:0x200C(使能UART,8位数据,无校验位,收使能3,发使能2)</p>
<h2 id="AFIO-复用IO"><a href="#AFIO-复用IO" class="headerlink" title="AFIO(复用IO)"></a>AFIO(复用IO)</h2><p>STM32的每个中断都可作为外部中断输入,每个外部中断可设置独立的触发方式</p>
<p>NIVE支持16个IO中断,为EXT0-EXT15,后面的序号为映射GPIOxn的序号,即EXT0可选择GPIOA0.GPIOB0…</p>
<h3 id="AFIO-EXTICR1-外部中断配置寄存器1"><a href="#AFIO-EXTICR1-外部中断配置寄存器1" class="headerlink" title="AFIO_EXTICR1(外部中断配置寄存器1)"></a>AFIO_EXTICR1(外部中断配置寄存器1)</h3><p>32位只使用低16位,共四组,每组四位,每组决定是A,B,C,D中的哪个,每组中的四位(0-16)决定GPIOXn的n值</p>
<h2 id="IWD-看门狗单元"><a href="#IWD-看门狗单元" class="headerlink" title="IWD(看门狗单元)"></a>IWD(看门狗单元)</h2><p>一个倒计时复位的独立程序,每一定周期获取特定输入重置倒计时,用于监测程序是否正常循环</p>
<h2 id="硬件词汇表"><a href="#硬件词汇表" class="headerlink" title="硬件词汇表"></a>硬件词汇表</h2><h3 id="缩写"><a href="#缩写" class="headerlink" title="缩写"></a>缩写</h3><table>
<thead>
<tr>
<th align="center">缩写</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">NIVE</td>
<td align="center">集成中断向量控制器</td>
</tr>
<tr>
<td align="center">GPIO</td>
<td align="center">通用输入输出端口</td>
</tr>
<tr>
<td align="center">HSE Osc</td>
<td align="center">高速外部晶体振荡器</td>
</tr>
<tr>
<td align="center">HSI RC</td>
<td align="center">内部RC振荡器</td>
</tr>
<tr>
<td align="center">CSS</td>
<td align="center">时钟监视系统</td>
</tr>
<tr>
<td align="center">AHB</td>
<td align="center">先进高速总线</td>
</tr>
<tr>
<td align="center">APB</td>
<td align="center">先进外部总线</td>
</tr>
<tr>
<td align="center">ENR</td>
<td align="center">使能寄存器</td>
</tr>
</tbody></table>
<h3 id="词根"><a href="#词根" class="headerlink" title="词根"></a>词根</h3><table>
<thead>
<tr>
<th align="center">词根</th>
<th align="center">含义集</th>
</tr>
</thead>
<tbody><tr>
<td align="center">A</td>
<td align="center">先进</td>
</tr>
<tr>
<td align="center">B</td>
<td align="center">总线\波特</td>
</tr>
<tr>
<td align="center">C</td>
<td align="center">时钟\控制</td>
</tr>
<tr>
<td align="center">D</td>
<td align="center">数据</td>
</tr>
<tr>
<td align="center">E</td>
<td align="center">外部\使能</td>
</tr>
<tr>
<td align="center">H</td>
<td align="center">高速</td>
</tr>
<tr>
<td align="center">I</td>
<td align="center">内部\输入</td>
</tr>
<tr>
<td align="center">L</td>
<td align="center">低速</td>
</tr>
<tr>
<td align="center">N</td>
<td align="center">集成</td>
</tr>
<tr>
<td align="center">O</td>
<td align="center">输出</td>
</tr>
<tr>
<td align="center">R</td>
<td align="center">寄存器\复位\速率</td>
</tr>
<tr>
<td align="center">S</td>
<td align="center">速度\系统\状态</td>
</tr>
</tbody></table>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/03/23/2023.3.23[STM32%E7%A1%AC%E4%BB%B6]/" data-id="clfl7ijbq00027ku3h08w5xdd" data-title="STM32F103ZE部分硬件配置指南" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2023/03/23/2023.3.23%5BTuring%20Complete%E6%94%BB%E7%95%A5%5D/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前一篇</strong>
      <div class="article-nav-title">
        
          Hello Wo
        
      </div>
    </a>
  
  
    <a href="/2023/03/17/2023.3.17%5B%E6%B1%87%E7%BC%96%5D/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">后一篇</strong>
      <div class="article-nav-title">基础汇编分享</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">三月 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/03/23/2023.3.23%5BTuring%20Complete%E6%94%BB%E7%95%A5%5D/">Hello Wo</a>
          </li>
        
          <li>
            <a href="/2023/03/23/2023.3.23%5BSTM32%E7%A1%AC%E4%BB%B6%5D/">STM32F103ZE部分硬件配置指南</a>
          </li>
        
          <li>
            <a href="/2023/03/17/2023.3.17%5B%E6%B1%87%E7%BC%96%5D/">基础汇编分享</a>
          </li>
        
          <li>
            <a href="/2023/03/17/2023.3.17%5B%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2%5D/">开始</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 Te4MIVal<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>